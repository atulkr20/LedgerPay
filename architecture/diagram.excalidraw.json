{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "id": "client",
      "type": "rectangle",
      "x": 50,
      "y": 20,
      "width": 120,
      "height": 60,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#dbeafe",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "Client / API\nConsumer",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "signup",
      "type": "rectangle",
      "x": 50,
      "y": 120,
      "width": 100,
      "height": 50,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#cffafe",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "POST /signup\n(Create User)",
      "fontSize": 12,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "login",
      "type": "rectangle",
      "x": 170,
      "y": 120,
      "width": 100,
      "height": 50,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#cffafe",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "POST /login\n(Get JWT)",
      "fontSize": 12,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "jwt_middleware",
      "type": "rectangle",
      "x": 110,
      "y": 220,
      "width": 120,
      "height": 50,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#e0e7ff",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "JWT Auth\nMiddleware",
      "fontSize": 12,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "balance",
      "type": "rectangle",
      "x": 300,
      "y": 220,
      "width": 90,
      "height": 45,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#d1fae5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "GET /balance",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "history",
      "type": "rectangle",
      "x": 410,
      "y": 220,
      "width": 90,
      "height": 45,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#d1fae5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "GET /history",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "add_money",
      "type": "rectangle",
      "x": 520,
      "y": 220,
      "width": 90,
      "height": 45,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#d1fae5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "POST /add-money\nðŸ”‘ Idempotent",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "transfer",
      "type": "rectangle",
      "x": 300,
      "y": 285,
      "width": 90,
      "height": 45,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#d1fae5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "POST /transfer\nðŸ”‘ Idempotent",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "withdraw",
      "type": "rectangle",
      "x": 410,
      "y": 285,
      "width": 90,
      "height": 45,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#d1fae5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "POST /withdraw\nðŸ”‘ Idempotent",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "refund",
      "type": "rectangle",
      "x": 520,
      "y": 285,
      "width": 90,
      "height": 45,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#d1fae5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "POST /refund\nðŸ”‘ Idempotent",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "redis_check",
      "type": "diamond",
      "x": 520,
      "y": 370,
      "width": 100,
      "height": 80,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#fef3c7",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "text": "Redis Cache\nCheck?",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "ledger_service",
      "type": "rectangle",
      "x": 50,
      "y": 370,
      "width": 130,
      "height": 80,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#dcfce7",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "LedgerService\n- createWallet()\n- addMoney()\n- transfer()\n- withdraw()\n- refund()\n- getBalance()",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "row_lock",
      "type": "rectangle",
      "x": 250,
      "y": 370,
      "width": 110,
      "height": 80,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#fce7f3",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "Row-Level\nLocking\n(SELECT FOR\nUPDATE)\nAlphabetical\nSort",
      "fontSize": 9,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "postgres",
      "type": "rectangle",
      "x": 50,
      "y": 500,
      "width": 130,
      "height": 100,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#fce4ec",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "PostgreSQL\nACID Transaction\n- User\n- Wallet\n- Account\n- Transaction\n- LedgerEntry",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "data_hierarchy",
      "type": "rectangle",
      "x": 250,
      "y": 500,
      "width": 180,
      "height": 100,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "#f3e5f5",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "roundness": 2,
      "text": "Data Model Hierarchy\nUser (1:1)\nâ†“\nWallet (1:N)\nâ†“\nAccount (1:N)\nâ†“\nTransaction â†’ LedgerEntry\n(Debit/Credit entries)",
      "fontSize": 10,
      "fontFamily": 2,
      "textAlign": "center",
      "verticalAlign": "middle"
    },
    {
      "id": "arrow1",
      "type": "arrow",
      "x": 110,
      "y": 80,
      "points": [[0, 0], [0, 40]],
      "strokeColor": "#1f2937",
      "startArrowType": "dot",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow2",
      "type": "arrow",
      "x": 220,
      "y": 80,
      "points": [[0, 0], [0, 40]],
      "strokeColor": "#1f2937",
      "startArrowType": "dot",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow3",
      "type": "arrow",
      "x": 170,
      "y": 170,
      "points": [[0, 0], [0, 50]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow4",
      "type": "arrow",
      "x": 300,
      "y": 265,
      "points": [[0, 0], [220, 0]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow5",
      "type": "arrow",
      "x": 410,
      "y": 265,
      "points": [[0, 0], [110, 0]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow6",
      "type": "arrow",
      "x": 565,
      "y": 265,
      "points": [[0, 0], [0, 105]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow7",
      "type": "arrow",
      "x": 565,
      "y": 450,
      "points": [[0, 0], [-335, 0]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow",
      "text": "Cache Hit/Miss"
    },
    {
      "id": "arrow8",
      "type": "arrow",
      "x": 185,
      "y": 410,
      "points": [[0, 0], [65, 0]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow"
    },
    {
      "id": "arrow9",
      "type": "arrow",
      "x": 115,
      "y": 450,
      "points": [[0, 0], [0, 50]],
      "strokeColor": "#1f2937",
      "endArrowType": "arrow"
    },
    {
      "id": "key-components",
      "type": "text",
      "x": 50,
      "y": 630,
      "width": 600,
      "height": 100,
      "angle": 0,
      "strokeColor": "#1f2937",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 1,
      "text": "Key Components:\nâ€¢ Authentication: JWT-based auth with auto-wallet creation on signup\nâ€¢ Idempotency: Redis caching prevents duplicate transactions (24h TTL + 10s lock)\nâ€¢ Business Logic: LedgerService handles double-entry accounting with row-level locking\nâ€¢ Database: PostgreSQL ACID transactions with deadlock prevention (alphabetical sorting)\nâ€¢ Data Model: User â†’ Wallet â†’ Account â†’ Transaction â†’ LedgerEntry hierarchy",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top"
    }
  ],
  "appState": {
    "zoom": {
      "value": 0.8
    },
    "scrolledOutside": false,
    "defaultSide": "top"
  }
}
